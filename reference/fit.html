<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a Time Series Forecasting Model with Formula Interface — fit • chronofeat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a Time Series Forecasting Model with Formula Interface — fit"><meta name="description" content="Train a forecasting model using a formula-based feature specification.
This function automatically generates time series features (lags, MAs, rolling stats,
calendar features) from the formula and fits the specified model."><meta property="og:description" content="Train a forecasting model using a formula-based feature specification.
This function automatically generates time series features (lags, MAs, rolling stats,
calendar features) from the formula and fits the specified model."><meta property="og:image" content="https://taf-society.github.io/chronofeat/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chronofeat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/custom-models.html">Building Custom Models</a></li>
    <li><a class="dropdown-item" href="../articles/feature-engineering.html">Feature Engineering Reference</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing.html">Data Preprocessing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Evaluation &amp; Production</h6></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-workflows.html">Advanced Workflows</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/taf-society/chronofeat" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit a Time Series Forecasting Model with Formula Interface</h1>
      <small class="dont-index">Source: <a href="https://github.com/taf-society/chronofeat/blob/main/R/fit.R" class="external-link"><code>R/fit.R</code></a></small>
      <div class="d-none name"><code>fit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Train a forecasting model using a formula-based feature specification.
This function automatically generates time series features (lags, MAs, rolling stats,
calendar features) from the formula and fits the specified model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, date <span class="op">=</span> <span class="cn">NULL</span>, groups <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">model</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula specifying the target and features using special syntax:</p><ul><li><p><code>p(k)</code> - Create k lags of the target (e.g., p(12))</p></li>
<li><p><code>q(w1, w2, ...)</code> - Create moving averages with specified windows (e.g., q(7,28))</p></li>
<li><p><code>dow()</code>, <code>month()</code>, <code>woy()</code>, <code>eom()</code>, <code>dom()</code> - Calendar features</p></li>
<li><p><code>rollsum(w1,w2)</code>, <code>rollsd(w)</code>, <code>rollmin(w)</code>, <code>rollmax(w)</code> - Rolling statistics</p></li>
<li><p><code>rollslope(w)</code> - Rolling trend slopes</p></li>
<li><p><code>lag(varname, k1, k2, ...)</code> - Lags of exogenous variables</p></li>
<li><p><code>ma(varname, w1, w2, ...)</code> - MAs of exogenous variables</p></li>
<li><p>Raw column names for direct inclusion</p></li>
</ul></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame or TimeSeries object containing the time series data</p></dd>


<dt id="arg-date">date<a class="anchor" aria-label="anchor" href="#arg-date"></a></dt>
<dd><p>Character string naming the date column (Date class required)</p></dd>


<dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>Character vector naming grouping columns for panel data</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Model specification as a list with <code>fit</code> and <code>predict</code> functions, or
a model function (for backward compatibility, e.g., <code>lm</code>, <code>glm</code>).</p><ul><li><p><code>fit(y, X, ...)</code> - Function that fits model with y (response) and X (predictors matrix)</p></li>
<li><p><code>predict(object, newdata, ...)</code> - Function that predicts from fitted model</p></li>
</ul></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the model$fit function</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>tsfeature_fit</code> object containing:</p><ul><li><p><code>model</code> - The fitted model object</p></li>
<li><p><code>data</code> - Training data with features</p></li>
<li><p><code>history_raw</code> - Raw historical data for forecasting</p></li>
<li><p><code>formula</code> - Expanded formula used for modeling</p></li>
<li><p><code>spec</code> - Feature specifications</p></li>
<li><p><code>meta</code> - Metadata (date, groups)</p></li>
<li><p><code>predictors</code> - Predictor column names</p></li>
<li><p><code>schema</code> - Predictor schema for type consistency</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function automatically:</p><ol><li><p>Parses the formula to identify feature specifications</p></li>
<li><p>Generates all requested features within groups</p></li>
<li><p>Removes rows with NA values in features (due to lagging/rolling)</p></li>
<li><p>Fits the model on the feature-engineered data</p></li>
<li><p>Stores necessary metadata for forecasting</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="edge-cases-and-important-behaviors">Edge Cases and Important Behaviors<a class="anchor" aria-label="anchor" href="#edge-cases-and-important-behaviors"></a></h2>



<p><strong>Data Sorting:</strong>
If using a TimeSeries object, data is automatically sorted by groups and date.
This ensures correct lag and difference calculations. If passing a plain data frame,
ensure it is pre-sorted by groups (if any) and date.</p>
<p><strong>Minimum Data Requirements:</strong></p><ul><li><p>Lags: If history length &lt; lag number, the lag feature will be NA</p></li>
<li><p>Moving averages: If history length &lt; window size, returns NA</p></li>
<li><p>Rolling statistics: Computed on available data (see below)</p></li>
<li><p>Frequency detection: Requires at least 2 date observations per group</p></li>
</ul><p><strong>Factor Variables:</strong>
Factor levels observed during training are stored in the model schema. During
forecasting, if new factor levels appear that weren't seen in training, they
will be silently converted to NA. Consider this when using categorical features
like day-of-week or month.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Load retail data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"data/retail.rda"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple model with 12 lags using linear regression</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="fu">p</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">retail</span>,</span></span>
<span class="r-in"><span>          date <span class="op">=</span> <span class="st">"date"</span>, groups <span class="op">=</span> <span class="st">"items"</span>, model <span class="op">=</span> <span class="va">lm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Model with lags, MAs, and calendar features</span></span></span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="fu">p</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/quit.html" class="external-link">q</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">28</span><span class="op">)</span> <span class="op">+</span> <span class="fu">month</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">dow</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          data <span class="op">=</span> <span class="va">retail</span>, date <span class="op">=</span> <span class="st">"date"</span>, groups <span class="op">=</span> <span class="st">"items"</span>, model <span class="op">=</span> <span class="va">lm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># GLM for count data</span></span></span>
<span class="r-in"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="fu">p</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span> <span class="op">+</span> <span class="fu">dow</span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">count_data</span>,</span></span>
<span class="r-in"><span>          date <span class="op">=</span> <span class="st">"date"</span>, groups <span class="op">=</span> <span class="st">"store"</span>,</span></span>
<span class="r-in"><span>          model <span class="op">=</span> <span class="va">glm</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom model specification</span></span></span>
<span class="r-in"><span><span class="va">custom_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  fit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># Your custom fitting logic</span></span></span>
<span class="r-in"><span>    <span class="va">train_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>.response <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, <span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">.response</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_df</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  predict <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="fu">p</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">retail</span>,</span></span>
<span class="r-in"><span>          date <span class="op">=</span> <span class="st">"date"</span>, groups <span class="op">=</span> <span class="st">"items"</span>, model <span class="op">=</span> <span class="va">custom_model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://taf-society.org/" class="external-link">Time Series Analysis and Forecasting Society</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

