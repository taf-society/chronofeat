<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate Recursive Multi-Step Forecasts — forecast.tsfeature_fit • chronofeat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Recursive Multi-Step Forecasts — forecast.tsfeature_fit"><meta name="description" content="Produce forecasts from a fitted tsfeature_fit model using recursive prediction.
Each forecast step feeds back into the model as a lag feature for subsequent steps."><meta property="og:description" content="Produce forecasts from a fitted tsfeature_fit model using recursive prediction.
Each forecast step feeds back into the model as a lag feature for subsequent steps."><meta property="og:image" content="https://taf-society.github.io/chronofeat/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chronofeat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Concepts</h6></li>
    <li><a class="dropdown-item" href="../articles/custom-models.html">Building Custom Models</a></li>
    <li><a class="dropdown-item" href="../articles/feature-engineering.html">Feature Engineering Reference</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing.html">Data Preprocessing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Evaluation &amp; Production</h6></li>
    <li><a class="dropdown-item" href="../articles/cross-validation.html">Cross-Validation</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-workflows.html">Advanced Workflows</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/taf-society/chronofeat" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate Recursive Multi-Step Forecasts</h1>
      <small class="dont-index">Source: <a href="https://github.com/taf-society/chronofeat/blob/main/R/forecast.R" class="external-link"><code>R/forecast.R</code></a></small>
      <div class="d-none name"><code>forecast.tsfeature_fit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produce forecasts from a fitted tsfeature_fit model using recursive prediction.
Each forecast step feeds back into the model as a lag feature for subsequent steps.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'tsfeature_fit'</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  h <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  future <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xreg_strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carry"</span>, <span class="st">"zeros"</span>, <span class="st">"NA"</span>, <span class="st">"error"</span><span class="op">)</span>,</span>
<span>  return_index <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_cpp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A <code>tsfeature_fit</code> object created by <code><a href="fit.html">fit()</a></code></p></dd>


<dt id="arg-h">h<a class="anchor" aria-label="anchor" href="#arg-h"></a></dt>
<dd><p>Integer, forecast horizon (number of steps ahead). Required if <code>future</code> is NULL</p></dd>


<dt id="arg-future">future<a class="anchor" aria-label="anchor" href="#arg-future"></a></dt>
<dd><p>Optional data frame containing future dates and exogenous variables.
Must include date column, group columns, and any raw exogenous variables used in the model</p></dd>


<dt id="arg-xreg-strategy">xreg_strategy<a class="anchor" aria-label="anchor" href="#arg-xreg-strategy"></a></dt>
<dd><p>Strategy for handling missing exogenous variables when <code>future</code> is NULL:</p><ul><li><p>"carry" - Carry forward last observed values</p></li>
<li><p>"zeros" - Fill with zeros</p></li>
<li><p>"NA" - Fill with NA</p></li>
<li><p>"error" - Throw error if exogenous variables needed</p></li>
</ul></dd>


<dt id="arg-return-index">return_index<a class="anchor" aria-label="anchor" href="#arg-return-index"></a></dt>
<dd><p>Logical, if TRUE return forecast steps (1, 2, ..., h) instead of dates</p></dd>


<dt id="arg-use-cpp">use_cpp<a class="anchor" aria-label="anchor" href="#arg-use-cpp"></a></dt>
<dd><p>Logical, if TRUE use C++ accelerated forecasting when possible (default: TRUE)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, if TRUE print informational messages about which forecasting path is used (default: FALSE)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments (currently unused, for S3 method compatibility)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Data frame with columns:</p><ul><li><p>Group columns (if specified in fit)</p></li>
<li><p>Date column or step index</p></li>
<li><p><code>{target}_forecast</code> - Point forecasts</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The forecast process:</p><ol><li><p>For each group, compute features from history</p></li>
<li><p>Predict one step ahead</p></li>
<li><p>Append prediction to history</p></li>
<li><p>Repeat for h steps</p></li>
</ol><p>If <code>future</code> is not provided, future dates are generated based on the frequency
stored in the model (from TimeSeries object) or using the median time difference
in the historical data within each group (fallback).</p>
    </div>
    <div class="section level2">
    <h2 id="edge-cases-during-forecasting">Edge Cases During Forecasting<a class="anchor" aria-label="anchor" href="#edge-cases-during-forecasting"></a></h2>



<p><strong>Incomplete Windows for Rolling Statistics:</strong></p>
<p>During recursive forecasting, when the requested window size exceeds available
history (actual observations + previous predictions), rolling statistics and
moving averages <strong>return NA</strong> to match training behavior.</p>
<p>Example at forecast step 3 with rollsum(7):</p><ul><li><p>Available history: 3 predicted values</p></li>
<li><p>Requested window: 7</p></li>
<li><p>Result: NA (incomplete window)</p></li>
</ul><p>This ensures consistency between training and forecasting:</p><ul><li><p>Training uses <code>slider::slide_dbl(..., .complete = TRUE)</code> which returns NA for incomplete windows</p></li>
<li><p>Forecasting mirrors this by returning NA when <code>length(history) &lt; window</code></p></li>
<li><p>Prevents train/test feature distribution mismatch</p></li>
<li><p>Models see the same NA pattern during training and forecasting</p></li>
</ul><p>The same NA-on-incomplete behavior applies to: rollsd(), rollmin(), rollmax(), rollslope(), and moving averages.</p>
<p><strong>Unknown Factor Levels:</strong></p>
<p>If <code>future</code> contains factor variables with levels not observed during training
(e.g., a new category), those values are silently converted to NA. This can happen with
calendar features if training data doesn't cover all days/months, or with categorical
exogenous variables.</p>
<p><strong>Trend Features:</strong></p>
<p>Trend features (trend(1), trend(2), etc.) continue incrementing beyond the training
range. For example, if trained on 100 observations, forecast step 1 will have trend=101.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Fit a model</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit.html">fit</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="fu">p</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/quit.html" class="external-link">q</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">28</span><span class="op">)</span> <span class="op">+</span> <span class="fu">month</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         data <span class="op">=</span> <span class="va">retail</span>, date <span class="op">=</span> <span class="st">"date"</span>, groups <span class="op">=</span> <span class="st">"items"</span>, model <span class="op">=</span> <span class="va">lm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate 24-step ahead forecast</span></span></span>
<span class="r-in"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">m</span>, h <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Forecast with step index instead of dates</span></span></span>
<span class="r-in"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">m</span>, h <span class="op">=</span> <span class="fl">24</span>, return_index <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Provide future exogenous variables</span></span></span>
<span class="r-in"><span><span class="va">future_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-01-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"month"</span>, length.out <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">retail</span><span class="op">$</span><span class="va">items</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  price <span class="op">=</span> <span class="fl">9.99</span>,</span></span>
<span class="r-in"><span>  promotion <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">m</span>, future <span class="op">=</span> <span class="va">future_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/taf-society" class="external-link">Resul Akay</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

